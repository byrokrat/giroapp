services:
    _defaults:
        public: false
        autowire: true

    byrokrat\giroapp\Listener\MonitoringListener:
        class: ~
        tags:
            - { name: event_listener, event: EXECUTION_STARTED,        method: dispatchDebug,   priority: 10 }
            - { name: event_listener, event: EXECUTION_STOPED,         method: dispatchDebug,   priority: 10 }
            - { name: event_listener, event: FILE_IMPORTED,            method: dispatchInfo,    priority: 10 }
            - { name: event_listener, event: FILE_EXPORTED,            method: dispatchInfo,    priority: 10 }
            - { name: event_listener, event: FILE_FORCEFULLY_IMPORTED, method: dispatchInfo,    priority: 10 }
            - { name: event_listener, event: DONOR_ADDED,              method: dispatchInfo,    priority: 10 }
            - { name: event_listener, event: DONOR_UPDATED,            method: dispatchInfo,    priority: 10 }
            - { name: event_listener, event: MANDATE_APPROVED,         method: dispatchInfo,    priority: 10 }
            - { name: event_listener, event: MANDATE_REVOKED,          method: dispatchInfo,    priority: 10 }
            - { name: event_listener, event: DONOR_REMOVED,            method: dispatchInfo,    priority: 10 }
            - { name: event_listener, event: MANDATE_INVALIDATED,      method: dispatchWarning, priority: 10 }

    byrokrat\giroapp\Listener\LoggingListener:
        class: ~
        arguments: ['@db_log_collection']
        tags:
            - { name: event_listener, event: ERROR,   method: onLogEvent, priority: 10 }
            - { name: event_listener, event: WARNING, method: onLogEvent, priority: 10 }
            - { name: event_listener, event: INFO,    method: onLogEvent, priority: 10 }

    byrokrat\giroapp\Listener\OutputtingListener:
        class: ~
        arguments: ['@std_out', '@err_out']
        tags:
            - { name: event_listener, event: ERROR,   priority: -10 }
            - { name: event_listener, event: WARNING, priority: -10 }
            - { name: event_listener, event: INFO,    priority: -10 }
            - { name: event_listener, event: DEBUG,   priority: -10 }

    byrokrat\giroapp\Listener\ExitStatusListener:
        class: ~
        public: true
        tags:
            - { name: event_listener, event: ERROR,   method: onFailure }
            - { name: event_listener, event: WARNING, method: onFailure }

    byrokrat\giroapp\Listener\FileImportChecksumListener:
        class: ~
        tags:
            - { name: event_listener, event: FILE_IMPORTED, priority: 10 }

    file_import_dumper:
        class: byrokrat\giroapp\Listener\FileDumpingListener
        arguments: ['@fs_imports']
        tags:
            - { name: event_listener, event: FILE_IMPORTED,            method: onFileEvent, priority: -10 }
            - { name: event_listener, event: FILE_FORCEFULLY_IMPORTED, method: onFileEvent, priority: -10 }

    file_export_dumper:
        class: byrokrat\giroapp\Listener\FileDumpingListener
        arguments: ['@fs_exports']
        tags:
            - { name: event_listener, event: FILE_EXPORTED, method: onFileEvent, priority: -9 }

    file_export_cwd_dumper:
        class: byrokrat\giroapp\Listener\FileDumpingListener
        arguments: ['@fs_cwd']
        tags:
            - { name: event_listener, event: FILE_EXPORTED, method: onFileEvent, priority: -10 }

    byrokrat\giroapp\Listener\FileImportingListener:
        class: ~
        tags:
            - { name: event_listener, event: FILE_IMPORTED }
            - { name: event_listener, event: FILE_FORCEFULLY_IMPORTED, method: onFileImported }

    byrokrat\giroapp\Listener\AutogiroImportingListener:
        class: ~
        tags:
            - { name: event_listener, event: AUTOGIRO_FILE_IMPORTED }

    byrokrat\giroapp\Listener\XmlImportingListener:
        class: ~
        tags:
            - { name: event_listener, event: XML_FILE_IMPORTED }

    byrokrat\giroapp\Listener\AutogiroFilteringListener:
        class: ~
        tags:
            - { name: event_listener, event: MANDATE_RESPONSE_RECEIVED, priority: 10 }

    byrokrat\giroapp\Listener\CommittingListener:
        class: ~
        arguments: ['@db']
        tags:
            - { name: event_listener, event: EXECUTION_STOPED }

    byrokrat\giroapp\Listener\MandateResponseListener:
        class: ~
        tags:
            - { name: event_listener, event: MANDATE_RESPONSE_RECEIVED }

    byrokrat\giroapp\Listener\DonorPersistingListener:
        class: ~
        tags:
            - { name: event_listener, event: DONOR_ADDED   }
            - { name: event_listener, event: DONOR_REMOVED }
            - { name: event_listener, event: DONOR_UPDATED,       method: onDonorUpdated }
            - { name: event_listener, event: MANDATE_APPROVED,    method: onDonorUpdated }
            - { name: event_listener, event: MANDATE_REVOKED,     method: onDonorUpdated }
            - { name: event_listener, event: MANDATE_INVALIDATED, method: onDonorUpdated }
