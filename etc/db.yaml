parameters:
    db.settings: '%fs.internal_data_dir%/settings.json'
    db.donors: '%fs.internal_data_dir%/donors.json'
    db.transactions: '%fs.internal_data_dir%/transactions.json'
    db.log: '%fs.external_data_dir%/log'
    db.imports: '%fs.internal_data_dir%/imports.json'

services:
    _defaults:
        public: false
        autowire: true

    db:
        class: hanneskod\yaysondb\Yaysondb
        arguments:
            -
                settings: '@db_settings_engine'
                donors: '@db_donor_engine'
                transactions: '@db_transaction_engine'
                imports: '@db_import_engine'
                log: '@db_log_engine'

    byrokrat\giroapp\Mapper\:
        resource: '../src/Mapper/*'

    byrokrat\giroapp\Mapper\SettingsMapper:
        class: ~
        arguments: ['@db_settings_collection']

    db_settings_mapper:
      alias: 'byrokrat\giroapp\Mapper\SettingsMapper'
      public: true

    db_settings_collection:
        class: hanneskod\yaysondb\Collection
        arguments: ['@db_settings_engine']

    db_settings_engine:
        class: hanneskod\yaysondb\Engine\FlysystemEngine
        arguments: ['%db.settings%', '@fs_user_dir']

    byrokrat\giroapp\Mapper\DonorMapper:
        class: ~
        arguments: ['@db_donor_collection']

    db_donor_collection:
        class: hanneskod\yaysondb\Collection
        arguments: ['@db_donor_engine']

    db_donor_engine:
        class: hanneskod\yaysondb\Engine\FlysystemEngine
        arguments: ['%db.donors%', '@fs_user_dir']

    byrokrat\giroapp\Mapper\TransactionMapper:
        class: ~
        arguments: ['@db_transaction_collection']

    db_transaction_collection:
        class: hanneskod\yaysondb\Collection
        arguments: ['@db_transaction_engine']

    db_transaction_engine:
        class: hanneskod\yaysondb\Engine\FlysystemEngine
        arguments: ['%db.transactions%', '@fs_user_dir']

    db_log_collection:
        class: hanneskod\yaysondb\Collection
        arguments: ['@db_log_engine']

    db_log_engine:
        class: hanneskod\yaysondb\Engine\LogEngine
        arguments: ['%fs.user_dir%/%db.log%']

    byrokrat\giroapp\Mapper\FileChecksumMapper:
        class: ~
        arguments: ['@db_import_collection']

    db_import_collection:
        class: hanneskod\yaysondb\Collection
        arguments: ['@db_import_engine']

    db_import_engine:
        class: hanneskod\yaysondb\Engine\FlysystemEngine
        arguments: ['%db.imports%', '@fs_user_dir']
