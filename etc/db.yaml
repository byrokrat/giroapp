parameters:
    db.donors: 'donors.json'
    db.imports: 'imports.json'

services:
    _defaults:
        public: false
        autowire: true

    byrokrat\giroapp\Mapper\:
        resource: '../src/Mapper/*'

    flysystem_data_dir:
        class: League\Flysystem\Filesystem
        arguments: ['@flysystem_data_dir_adapter']

    flysystem_data_dir_adapter:
        class: League\Flysystem\Adapter\Local
        arguments: ["@=service('fs_data').getAbsolutePath('.')"]

    db:
        class: hanneskod\yaysondb\Yaysondb
        arguments:
            -
                donors: '@db_donor_engine'
                imports: '@db_import_engine'
                log: '@db_log_engine'

    byrokrat\giroapp\Mapper\DonorMapper:
        class: ~
        arguments: ['@db_donor_collection']

    db_donor_collection:
        class: hanneskod\yaysondb\Collection
        arguments: ['@db_donor_engine']

    db_donor_engine:
        class: hanneskod\yaysondb\Engine\FlysystemEngine
        arguments: ['%db.donors%', '@flysystem_data_dir']

    db_log_collection:
        class: hanneskod\yaysondb\Collection
        arguments: ['@db_log_engine']

    db_log_engine:
        class: hanneskod\yaysondb\Engine\LogEngine
        arguments:
            - "@=service('fs_external_data').getAbsolutePath('log')"
            - '@byrokrat\giroapp\Mapper\LogFormatter'

    byrokrat\giroapp\Mapper\FileChecksumMapper:
        class: ~
        arguments: ['@db_import_collection']

    db_import_collection:
        class: hanneskod\yaysondb\Collection
        arguments: ['@db_import_engine']

    db_import_engine:
        class: hanneskod\yaysondb\Engine\FlysystemEngine
        arguments: ['%db.imports%', '@flysystem_data_dir']
