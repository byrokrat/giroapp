parameters:
    db.settings: 'data/settings.json'
    db.donors: 'data/donors.json'
    db.transactions: 'data/transactions.json'
    db.log: 'var/log'

services:
    db_handle:
        class: hanneskod\yaysondb\Yaysondb
        arguments:
            -
                settings: '@db_settings_engine'
                donors: '@db_donors_engine'
                transactions: '@db_transactions_engine'
                log: '@db_log_engine'

    settings_mapper:
        class: byrokrat\giroapp\Mapper\SettingsMapper
        arguments: ['@db_settings_collection']

    db_settings_collection:
        class: hanneskod\yaysondb\Collection
        arguments: ['@db_settings_engine']

    donor_builder:
        class: byrokrat\giroapp\Builder\DonorBuilder

    donor_mapper:
        class: byrokrat\giroapp\Mapper\DonorMapper
        arguments: ['@db_donors_collection', '@donor_schema']

    donor_schema:
        class: byrokrat\giroapp\Mapper\Schema\DonorSchema
        arguments: ['@postal_address_schema', '@donor_state_factory', '@account_factory', '@id_factory']

    db_donors_collection:
        class: hanneskod\yaysondb\Collection
        arguments: ['@db_donors_engine']

    db_donors_engine:
        class: hanneskod\yaysondb\Engine\FlysystemEngine
        arguments: ['%db.donors%', '@filesystem']

    transaction_mapper:
        class: byrokrat\giroapp\Mapper\TransactionMapper
        arguments: ['@db_transactions_collection']

    db_transactions_collection:
        class: hanneskod\yaysondb\Collection
        arguments: ['@db_transactions_engine']

    db_transactions_engine:
        class: hanneskod\yaysondb\Engine\FlysystemEngine
        arguments: ['%db.transactions%', '@filesystem']

    db_log_collection:
        class: hanneskod\yaysondb\Collection
        arguments: ['@db_log_engine']

    db_log_engine:
        class: hanneskod\yaysondb\Engine\LogEngine
        arguments: ['%user.dir%/%db.log%', '@db_log_formatter']

    db_log_formatter:
        class: byrokrat\giroapp\LogFormatter

    postal_address_schema:
        class: byrokrat\giroapp\Mapper\Schema\PostalAddressSchema

    donor_state_factory:
        class: byrokrat\giroapp\Model\DonorState\DonorStateFactory
