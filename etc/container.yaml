parameters:
    app.name: 'GiroApp'
    app.version: '1.0.0-alpha3@dev'
    env(GIROAPP_PATH): 'giroapp'
    env(GIROAPP_INI_FILE): '%env(GIROAPP_PATH)%/giroapp.ini'
    app.ini_file_name: '%env(GIROAPP_INI_FILE)%'

imports:
    - { resource: fs.yaml }
    - { resource: db.yaml }
    - { resource: listeners.yaml }

services:
    _defaults:
        public: false
        autowire: true

    byrokrat\giroapp\Config\ConfigManager:
        class: ~
        configurator: 'byrokrat\giroapp\Config\ConfigManagerConfigurator:loadConfigFile'

    configs:
        alias: byrokrat\giroapp\Config\ConfigManager
        public: true

    byrokrat\giroapp\Config\ConfigManagerConfigurator:
        class: ~
        arguments: ['@fs_cwd', '%app.ini_file_name%']

    byrokrat\giroapp\Builder\:
        resource: '../src/Builder/*'

    byrokrat\giroapp\Builder\DateBuilder:
        class: ~
        arguments:
            $dayOfMonth: "@=service('configs').getConfig('trans.day_of_month')"
            $minDaysInFuture: "@=service('configs').getConfig('trans.min_days_in_future')"

    byrokrat\giroapp\Console\:
        public: true
        resource: '../src/Console/*'
        exclude: '../src/Console/{Adapter,Helper/InputReader}.php'

    byrokrat\giroapp\Console\ImportCommand:
        class: ~
        public: true
        arguments: ['@fs_cwd']

    byrokrat\giroapp\Console\ValidateCommand:
        class: ~
        public: true
        arguments:
            - '@fs_user_dir'
            - "@=service('byrokrat\\\\giroapp\\\\Mapper\\\\Schema\\\\DonorSchema').getJsonSchema()"

    byrokrat\giroapp\Console\Helper\Validators:
        class: ~
        arguments:
            $bankgiroFactory: '@byrokrat\banking\BankgiroFactory'

    byrokrat\giroapp\Filter\:
        resource: '../src/Filter/*'

    byrokrat\giroapp\Formatter\:
        resource: '../src/Formatter/*'

    byrokrat\giroapp\State\:
        resource: '../src/State/*'

    byrokrat\giroapp\Utils\:
        resource: '../src/Utils/*'

    byrokrat\giroapp\Plugin\EnvironmentInterface:
        class: byrokrat\giroapp\Plugin\Environment
        public: true
        configurator: 'byrokrat\giroapp\Plugin\PluginLoader:loadPlugins'

    byrokrat\giroapp\Plugin\PluginLoader:
        class: ~
        arguments: ['@fs_plugins']

    byrokrat\giroapp\Xml\XmlMandateParser:
        class: ~
        arguments: ['@organization_id', '@organization_bg']

    byrokrat\giroapp\Xml\XmlFormTranslator: ~

    byrokrat\giroapp\AutogiroVisitor:
        class: ~
        arguments:
            - "@=service('configs').getConfig('org.bgc_number')"
            - '@organization_bg'

    byrokrat\autogiro\Writer\WriterInterface:
        factory: 'byrokrat\giroapp\AutogiroWriterFactory:createWriter'
        arguments:
            - "@=service('configs').getConfig('org.bgc_number')"
            - '@organization_bg'

    byrokrat\giroapp\AutogiroWriterFactory: ~

    byrokrat\autogiro\Writer\WriterFactory: ~

    byrokrat\autogiro\Parser\ParserInterface:
        factory: 'byrokrat\autogiro\Parser\ParserFactory:createParser'

    byrokrat\autogiro\Parser\ParserFactory: ~

    byrokrat\banking\AccountFactoryInterface:
        class: byrokrat\banking\AccountFactory
        autowire: false

    byrokrat\giroapp\Config\OrgBankgiroFactory:
        class: ~
        arguments: ['@byrokrat\banking\BankgiroFactory']

    byrokrat\banking\BankgiroFactory: ~

    byrokrat\giroapp\Config\OrgIdFactory:
        class: ~
        arguments: ['@byrokrat\id\IdFactoryInterface']

    byrokrat\id\IdFactoryInterface:
        class: byrokrat\id\PersonalIdFactory
        autowire: false
        arguments: ['@byrokrat\id\OrganizationIdFactory']

    byrokrat\id\OrganizationIdFactory:
        class: ~
        autowire: false

    organization_id:
        class: byrokrat\id\IdInterface
        factory: 'byrokrat\giroapp\Config\OrgIdFactory:createId'
        arguments: ["@=service('configs').getConfig('org.state_id')"]

    organization_bg:
        class: byrokrat\banking\AccountNumber
        factory: 'byrokrat\giroapp\Config\OrgBankgiroFactory:createAccount'
        arguments: ["@=service('configs').getConfig('org.bankgiro')"]

    JsonSchema\Validator: ~

    Symfony\Component\Console\Application:
        class: ~
        arguments: ['%app.name%', '%app.version%']
        public: true

    Symfony\Component\EventDispatcher\EventDispatcherInterface:
        class: 'Symfony\Component\EventDispatcher\EventDispatcher'
