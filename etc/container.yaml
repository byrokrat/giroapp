parameters:
    app.name: 'GiroApp'
    app.version: '$app_version$'
    env(GIROAPP_INI): 'giroapp.ini'

imports:
    - { resource: fs.yaml }
    - { resource: db.yaml }
    - { resource: listeners.yaml }

services:
    _defaults:
        public: false
        autowire: true
        bind:
            $filesystem: '@fs_cwd'

    Symfony\Component\Console\Application:
        class: ~
        arguments: ['%app.name%', '%app.version%']
        public: true

    ini:
        alias: byrokrat\giroapp\Config\ConfigManager
        public: true

    byrokrat\giroapp\Config\ConfigManager:
        class: ~
        arguments: ['@base_dir_repository']
        configurator: 'byrokrat\giroapp\Config\IniFileLoader:loadIniFile'

    base_dir_repository:
        class: byrokrat\giroapp\Config\ArrayRepository
        arguments: [base_dir: "@=service('base_dir_reader').getBaseDir()"]

    base_dir_reader:
        class: byrokrat\giroapp\Config\BaseDirReader
        arguments: ['%env(GIROAPP_INI)%']

    byrokrat\giroapp\Config\IniFileLoader:
        class: ~
        arguments: ['%env(GIROAPP_INI)%']

    organization_id:
        class: byrokrat\id\IdInterface
        factory: 'byrokrat\id\IdFactoryInterface:createId'
        arguments: ["@=service('ini').getConfigValue('org_id')"]

    organization_bg:
        class: byrokrat\banking\AccountNumber
        factory: 'byrokrat\banking\BankgiroFactory:createAccount'
        arguments: ["@=service('ini').getConfigValue('org_bg')"]

    byrokrat\giroapp\Console\:
        resource: '../src/Console/*'

    byrokrat\giroapp\Console\ValidateCommand:
        class: ~
        arguments:
            - '@fs_db'
            - "@=service('byrokrat\\\\giroapp\\\\Mapper\\\\Schema\\\\DonorSchema').getJsonSchema()"

    byrokrat\giroapp\Filter\:
        resource: '../src/Filter/*'

    byrokrat\giroapp\Formatter\:
        resource: '../src/Formatter/*'

    byrokrat\giroapp\Sorter\:
        resource: '../src/Sorter/*'

    byrokrat\giroapp\Model\Builder\:
        resource: '../src/Model/Builder/*'

    byrokrat\giroapp\Plugin\EnvironmentInterface:
        class: byrokrat\giroapp\Plugin\Environment
        public: true
        configurator: 'byrokrat\giroapp\Plugin\PluginCollection:loadPlugin'

    byrokrat\giroapp\Plugin\PluginCollection:
        class: ~
        arguments:
            - '@byrokrat\giroapp\Plugin\FilesystemLoadingPlugin'
            - '@byrokrat\giroapp\Plugin\CorePlugin'

    byrokrat\giroapp\Plugin\CorePlugin:
        class: ~

    byrokrat\giroapp\Plugin\FilesystemLoadingPlugin:
        class: ~
        arguments: ['@fs_plugins']

    byrokrat\giroapp\State\:
        resource: '../src/State/*'

    byrokrat\giroapp\State\TransactionDateFactory:
        class: ~
        arguments:
            $dayOfMonth: "@=service('ini').getConfig('trans_day_of_month')"
            $minDaysInFuture: "@=service('ini').getConfig('trans_min_days_in_future')"

    byrokrat\giroapp\Utils\:
        resource: '../src/Utils/*'

    byrokrat\giroapp\Xml\XmlMandateParser:
        class: ~
        arguments: ['@organization_id', '@organization_bg']

    byrokrat\giroapp\Xml\XmlFormTranslator: ~

    byrokrat\giroapp\AutogiroVisitor:
        class: ~
        arguments:
            - "@=service('ini').getConfig('org_bgc_nr')"
            - '@organization_bg'

    byrokrat\giroapp\AutogiroWriterFactory: ~

    byrokrat\autogiro\Writer\WriterInterface:
        factory: 'byrokrat\giroapp\AutogiroWriterFactory:createWriter'
        arguments:
            - "@=service('ini').getConfig('org_bgc_nr')"
            - '@organization_bg'

    byrokrat\autogiro\Writer\WriterFactory: ~

    byrokrat\autogiro\Parser\ParserInterface:
        factory: 'byrokrat\autogiro\Parser\ParserFactory:createParser'

    byrokrat\autogiro\Parser\ParserFactory: ~

    byrokrat\banking\AccountFactoryInterface:
        class: byrokrat\banking\AccountFactory
        autowire: false

    byrokrat\banking\BankgiroFactory: ~

    byrokrat\id\IdFactoryInterface:
        class: byrokrat\id\PersonalIdFactory
        autowire: false
        arguments: ['@byrokrat\id\OrganizationIdFactory']

    byrokrat\id\OrganizationIdFactory:
        class: ~
        autowire: false

    JsonSchema\Validator: ~

    Symfony\Component\EventDispatcher\EventDispatcherInterface:
        class: 'Symfony\Component\EventDispatcher\EventDispatcher'
